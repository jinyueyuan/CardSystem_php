<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>人脉管理系统</title>
		<meta name="keywords" content="人脉管理系统" />
		<meta name="description" content="SJTU人脉管理系统" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<!-- basic styles -->

		<link href="assets/css/bootstrap.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="assets/css/font-awesome.min.css" />

		<!--[if IE 7]>
		  <link rel="stylesheet" href="assets/css/font-awesome-ie7.min.css" />
		<![endif]-->

		<!-- page specific plugin styles -->

		<!-- fonts -->

		<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:400,300" />

		<!-- ace styles -->

		<link rel="stylesheet" href="assets/css/ace.min.css" />
		<link rel="stylesheet" href="assets/css/ace-rtl.min.css" />
		<link rel="stylesheet" href="assets/css/ace-skins.min.css" />
		<!--[if lte IE 8]>
		  <link rel="stylesheet" href="assets/css/ace-ie.min.css" />
		<![endif]-->

		<!-- inline styles related to this page -->

		<!-- ace settings handler -->

		<script src="assets/js/ace-extra.min.js"></script>

		<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->

		<!--[if lt IE 9]>
		<script src="assets/js/html5shiv.js"></script>
		<script src="assets/js/respond.min.js"></script>
		<![endif]-->
	</head>

	<body>
		<div class="navbar navbar-default" id="navbar">
			<script type="text/javascript">
				try{ace.settings.check('navbar' , 'fixed')}catch(e){}
			</script>

			<div class="navbar-container" id="navbar-container">
				<div class="navbar-header pull-left">
					<a href="#" class="navbar-brand">
						<small>
							<i class="icon-leaf"></i>
							Network Management
						</small>
					</a><!-- /.brand -->
				</div><!-- /.navbar-header -->

				<div class="navbar-header pull-right" role="navigation">
					<ul class="nav ace-nav">
						<li class="grey">
							<a data-toggle="dropdown" class="dropdown-toggle" href="#">
								<i class="icon-tasks"></i>
								<span class="badge badge-grey">4</span>
							</a>

							<ul class="pull-right dropdown-navbar dropdown-menu dropdown-caret dropdown-close">
								<li class="dropdown-header">
									<i class="icon-ok"></i>
									4 Tasks to complete
								</li>

								<li>
									<a href="#">
										<div class="clearfix">
											<span class="pull-left">Software Update</span>
											<span class="pull-right">65%</span>
										</div>

										<div class="progress progress-mini ">
											<div style="width:65%" class="progress-bar "></div>
										</div>
									</a>
								</li>

								<li>
									<a href="#">
										<div class="clearfix">
											<span class="pull-left">Hardware Upgrade</span>
											<span class="pull-right">35%</span>
										</div>

										<div class="progress progress-mini ">
											<div style="width:35%" class="progress-bar progress-bar-danger"></div>
										</div>
									</a>
								</li>

								<li>
									<a href="#">
										<div class="clearfix">
											<span class="pull-left">Unit Testing</span>
											<span class="pull-right">15%</span>
										</div>

										<div class="progress progress-mini ">
											<div style="width:15%" class="progress-bar progress-bar-warning"></div>
										</div>
									</a>
								</li>

								<li>
									<a href="#">
										<div class="clearfix">
											<span class="pull-left">Bug Fixes</span>
											<span class="pull-right">90%</span>
										</div>

										<div class="progress progress-mini progress-striped active">
											<div style="width:90%" class="progress-bar progress-bar-success"></div>
										</div>
									</a>
								</li>

								<li>
									<a href="#">
										See tasks with details
										<i class="icon-arrow-right"></i>
									</a>
								</li>
							</ul>
						</li>

						<li class="purple">
							<a data-toggle="dropdown" class="dropdown-toggle" href="#">
								<i class="icon-bell-alt icon-animated-bell"></i>
								<span class="badge badge-important">8</span>
							</a>

							<ul class="pull-right dropdown-navbar navbar-pink dropdown-menu dropdown-caret dropdown-close">
								<li class="dropdown-header">
									<i class="icon-warning-sign"></i>
									8 Notifications
								</li>

								<li>
									<a href="#">
										<div class="clearfix">
											<span class="pull-left">
												<i class="btn btn-xs no-hover btn-pink icon-comment"></i>
												New Comments
											</span>
											<span class="pull-right badge badge-info">+12</span>
										</div>
									</a>
								</li>

								<li>
									<a href="#">
										<i class="btn btn-xs btn-primary icon-user"></i>
										Bob just signed up as an editor ...
									</a>
								</li>

								<li>
									<a href="#">
										<div class="clearfix">
											<span class="pull-left">
												<i class="btn btn-xs no-hover btn-success icon-shopping-cart"></i>
												New Orders
											</span>
											<span class="pull-right badge badge-success">+8</span>
										</div>
									</a>
								</li>

								<li>
									<a href="#">
										<div class="clearfix">
											<span class="pull-left">
												<i class="btn btn-xs no-hover btn-info icon-twitter"></i>
												Followers
											</span>
											<span class="pull-right badge badge-info">+11</span>
										</div>
									</a>
								</li>

								<li>
									<a href="#">
										See all notifications
										<i class="icon-arrow-right"></i>
									</a>
								</li>
							</ul>
						</li>

						<li class="green">
							<a data-toggle="dropdown" class="dropdown-toggle" href="#">
								<i class="icon-envelope icon-animated-vertical"></i>
								<span class="badge badge-success">5</span>
							</a>

							<ul class="pull-right dropdown-navbar dropdown-menu dropdown-caret dropdown-close">
								<li class="dropdown-header">
									<i class="icon-envelope-alt"></i>
									5 Messages
								</li>

								<li>
									<a href="#">
										<img src="assets/avatars/avatar.png" class="msg-photo" alt="Alex's Avatar" />
										<span class="msg-body">
											<span class="msg-title">
												<span class="blue">Alex:</span>
												Ciao sociis natoque penatibus et auctor ...
											</span>

											<span class="msg-time">
												<i class="icon-time"></i>
												<span>a moment ago</span>
											</span>
										</span>
									</a>
								</li>

								<li>
									<a href="#">
										<img src="assets/avatars/avatar3.png" class="msg-photo" alt="Susan's Avatar" />
										<span class="msg-body">
											<span class="msg-title">
												<span class="blue">Susan:</span>
												Vestibulum id ligula porta felis euismod ...
											</span>

											<span class="msg-time">
												<i class="icon-time"></i>
												<span>20 minutes ago</span>
											</span>
										</span>
									</a>
								</li>

								<li>
									<a href="#">
										<img src="assets/avatars/avatar4.png" class="msg-photo" alt="Bob's Avatar" />
										<span class="msg-body">
											<span class="msg-title">
												<span class="blue">Bob:</span>
												Nullam quis risus eget urna mollis ornare ...
											</span>

											<span class="msg-time">
												<i class="icon-time"></i>
												<span>3:15 pm</span>
											</span>
										</span>
									</a>
								</li>

								<li>
									<a href="inbox.html">
										See all messages
										<i class="icon-arrow-right"></i>
									</a>
								</li>
							</ul>
						</li>

						<li class="light-blue">
							<a data-toggle="dropdown" href="#" class="dropdown-toggle">
								<img class="nav-user-photo" src="assets/avatars/user.jpg" alt="Jason's Photo" />
								<span class="user-info" id="username">
									<small>Welcome,</small>
									{{username}}
								</span>

								<i class="icon-caret-down"></i>
							</a>

							<ul class="user-menu pull-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">
								<li>
									<a href="#">
										<i class="icon-cog"></i>
										Settings
									</a>
								</li>

								<li>
									<a href="#">
										<i class="icon-user"></i>
										Profile
									</a>
								</li>

								<li class="divider"></li>

								<li>
									<a href="javascript:void(0)" onclick="logout()">
										<i class="icon-off"></i>
										Logout
									</a>
								</li>
							</ul>
						</li>
					</ul><!-- /.ace-nav -->
				</div><!-- /.navbar-header -->
			</div><!-- /.container -->
		</div>

		<div class="main-container" id="main-container">
			<script type="text/javascript">
				try{ace.settings.check('main-container' , 'fixed')}catch(e){}
			</script>

			<div class="main-container-inner">
				<a class="menu-toggler" id="menu-toggler" href="#">
					<span class="menu-text"></span>
				</a>

				<div class="sidebar" id="sidebar">
					<script type="text/javascript">
						try{ace.settings.check('sidebar' , 'fixed')}catch(e){}
					</script>

					<div class="sidebar-shortcuts" id="sidebar-shortcuts">
						<div class="sidebar-shortcuts-large" id="sidebar-shortcuts-large">
							<button class="btn btn-success">
								<i class="icon-signal"></i>
							</button>

							<button class="btn btn-info">
								<i class="icon-pencil"></i>
							</button>

							<button class="btn btn-warning">
								<i class="icon-group"></i>
							</button>

							<button class="btn btn-danger">
								<i class="icon-cogs"></i>
							</button>
						</div>

						<div class="sidebar-shortcuts-mini" id="sidebar-shortcuts-mini">
							<span class="btn btn-success"></span>

							<span class="btn btn-info"></span>

							<span class="btn btn-warning"></span>

							<span class="btn btn-danger"></span>
						</div>
					</div><!-- #sidebar-shortcuts -->

					<ul class="nav nav-list">
						<li class="user active">
							<a href="home.html">
								<i class="icon-dashboard"></i>
								<span class="menu-text"> 人脉分析 </span>
							</a>
						</li>

						<li class="manager">
							<a href="flowMonitor.html">
								<i class="icon-text-width"></i>
								<span class="menu-text"> 流量监控 </span>
							</a>
						</li>

						<li class="manager">
							<a href="#" class="dropdown-toggle">
								<i class="icon-desktop"></i>
								<span class="menu-text"> 用户管理 </span>

								<b class="arrow icon-angle-down"></b>
							</a>

							<ul class="submenu">
								<li>
									<a href="userList.html">
										<i class="icon-double-angle-right"></i>
										查看用户名单
									</a>
								</li>

								<li>
									<a href="blackUser.html">
										<i class="icon-double-angle-right"></i>
										查看黑名单用户
									</a>
								</li>
							</ul>
						</li>
						<li class="user">
							<a href="talkAnalyse.html" class="dropdown-toggle">
								<i class="icon-edit"></i>
								<span class="menu-text"> 谈资分析 </span>
							</a>
						</li>

						<li class="user">
							<a href="gallery.html">
								<i class="icon-picture"></i>
								<span class="menu-text"> 相册 </span>
							</a>
						</li>


							</ul>
						</li>
					</ul><!-- /.nav-list -->

					<div class="sidebar-collapse" id="sidebar-collapse">
						<i class="icon-double-angle-left" data-icon1="icon-double-angle-left" data-icon2="icon-double-angle-right"></i>
					</div>

					<script type="text/javascript">
						try{ace.settings.check('sidebar' , 'collapsed')}catch(e){}
					</script>
				</div>

				<div class="main-content">
					<div class="breadcrumbs" id="breadcrumbs">
						<script type="text/javascript">
							try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
						</script>

						<ul class="breadcrumb">
							<li>
								<i class="icon-home home-icon"></i>
								<a href="#">Home</a>
							</li>
						</ul><!-- .breadcrumb -->

						<div class="nav-search" id="nav-search">
							<form class="form-search">
								<span class="input-icon">
									<input type="text" placeholder="Search ..." class="nav-search-input" id="nav-search-input" autocomplete="off" />
									<i class="icon-search nav-search-icon"></i>
								</span>
							</form>
						</div><!-- #nav-search -->
					</div>

					<div class="page-content">
						<div class="row">
							<div class="col-xs-12">
								<!-- PAGE CONTENT BEGINS -->
								<div class="page-header">
									<h1>
										Here
										<small>
											<!--<i class="icon-double-angle-right"></i>-->
											Comes your analysis.
										</small>
									</h1>
								</div><!-- /.page-header -->
								<div class="row">
									<div class="col-xs-12">
									 	<div class="col-sm-8">
									 		 <canvas id="viewport" width="800" height="550"></canvas></div>
									
										<div class="col-sm-4">
										<div class="widget-box transparent">
											<div class="widget-header widget-header-flat">
												<h4 class="lighter">
													<i class="icon-star orange"></i>
													人脉推荐
												</h4>

												<div class="widget-toolbar">
													<a href="#" data-action="collapse">
														<i class="icon-chevron-up"></i>
													</a>
												</div>
											</div>

											<div class="widget-body">
												<div class="widget-main no-padding" id="suggestList">
													<table class="table table-bordered table-striped" >
														<thead class="thin-border-bottom">
															<tr>
																<th>
																	<i class="icon-caret-right blue"></i>
																	人脉名称
																</th>

																<th>
																	<i class="icon-caret-right blue"></i>
																	共同人脉数量
																</th>

																<th class="hidden-480">
																	<i class="icon-caret-right blue"></i>
																	
																	状态
																</th>
															</tr>
														</thead>

														<tbody v-for="(data,index) in datas">
															<tr>
																<td>{{data[0]}}</td>

																<td>
								
																	<b class="green">{{data[1]}}</b>
																</td>

																<td class="hidden-480">
																<div class="visible-md visible-lg hidden-sm hidden-xs action-buttons">
																

																<a class="blue" href="javascript:void(0)"  v-on:click="addRelation(index)">
																	<i class="icon-pencil bigger-130"></i>
																	<span>加为好友</span>
																</a>
															<!-- <span class="label label-info arrowed-right arrowed-in">加为好友</span> -->
												
															</div>
																
																	
																</td>
															</tr>

															
														</tbody>
													</table>
												</div><!-- /widget-main -->
											</div><!-- /widget-body -->
										</div><!-- /widget-box -->
									</div>
										</div>
									 
									</div>
								</div>
								
								
								<!-- PAGE CONTENT ENDS -->
							</div><!-- /.col -->
						</div><!-- /.row -->
					</div><!-- /.page-content -->
				</div><!-- /.main-content -->

				<div class="ace-settings-container" id="ace-settings-container">
					<div class="btn btn-app btn-xs btn-warning ace-settings-btn" id="ace-settings-btn">
						<i class="icon-cog bigger-150"></i>
					</div>

					<div class="ace-settings-box" id="ace-settings-box">
						<div>
							<div class="pull-left">
								<select id="skin-colorpicker" class="hide">
									<option data-skin="default" value="#438EB9">#438EB9</option>
									<option data-skin="skin-1" value="#222A2D">#222A2D</option>
									<option data-skin="skin-2" value="#C6487E">#C6487E</option>
									<option data-skin="skin-3" value="#D0D0D0">#D0D0D0</option>
								</select>
							</div>
							<span>&nbsp; Choose Skin</span>
						</div>

						<div>
							<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-navbar" />
							<label class="lbl" for="ace-settings-navbar"> Fixed Navbar</label>
						</div>

						<div>
							<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-sidebar" />
							<label class="lbl" for="ace-settings-sidebar"> Fixed Sidebar</label>
						</div>

						<div>
							<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-breadcrumbs" />
							<label class="lbl" for="ace-settings-breadcrumbs"> Fixed Breadcrumbs</label>
						</div>

						<div>
							<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-rtl" />
							<label class="lbl" for="ace-settings-rtl"> Right To Left (rtl)</label>
						</div>

						<div>
							<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-add-container" />
							<label class="lbl" for="ace-settings-add-container">
								Inside
								<b>.container</b>
							</label>
						</div>
					</div>
				</div><!-- /#ace-settings-container -->
			</div><!-- /.main-container-inner -->

			<a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
				<i class="icon-double-angle-up icon-only bigger-110"></i>
			</a>
		</div><!-- /.main-container -->

		<!-- basic scripts -->
<script src='assets/js/jquery-2.0.3.min.js'></script>
		
		<script src="assets/js/arbor.js"></script>  

  		<script src="assets/js/main.js"></script>
  		<script src="assets/js/vue.js"></script>
		<script type="text/javascript">
			window.jQuery || document.write("<script src='assets/js/jquery-2.0.3.min.js'>"+"<"+"/script>");
		</script>

		<!-- <![endif]-->

		<!--[if IE]>
<script type="text/javascript">
 window.jQuery || document.write("<script src='assets/js/jquery-1.10.2.min.js'>"+"<"+"/script>");
</script>
<![endif]-->

<script src="assets/js/cookie.js"></script>
		<script type="text/javascript">
            $(document).ready(function() {
                var authority=getCookie("authority");
                if(authority!=null){
                    if(authority==1)
						$(".manager").remove();
                    else if(authority==2){
                        $(".user").remove();
					}
                }
            })
			if("ontouchend" in document) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
			//alert(getCookie("username"));
			//wenzhianalyze();
			var count=0;
			var objectnumber = 0;
			var userMap =  new Map();
			var suggestMap = new Map();
			var suggestNumber = 3;
			var userArray = new Array();
			//suggestMap.set("aaa",2);
			//suggestMap.set("bbb",4);
			//suggestMap.set("ccc",3);
			
			          /* $.ajax({
   				       type: "DELETE",
   				       url: "http://120.79.42.137:8080/Entity/Ud7adca934ab4e/Card/Userrelation/1514034454981",
   				       dataType:"json",
   				       success: function(data) {
   				         if(data!=null){
   				       
   				        	 alert("删除成功");
   				         }
   				         else 
   				        	 alert("删除失败！");
   				       },
   				       error:function(){
   				    	   alert("ajax失败");
   				       }
   				     });*/
			var vm = new Vue({  
              el: "#suggestList",  
              data: {  
            	  datas: []  
              },  
              methods: {  
                  getdata: function () {  //查询数据     	  
                	  var self = this;  
                	  computeRelation(getCookie('username'),userMap);		
                	  //alert(userMap);
                	  var suggestArray = new Array();
                	 // var mapIter  = suggestMap.entries();
                	 for (const entry of suggestMap) {
                		 suggestArray.push(entry);
					 }
                	 suggestArray.sort(function(a,b){
                		 return b[1]-a[1];
                	 })
                	 for(var i=0;i<suggestArray.length&&i<suggestNumber;i++){
                		 self.datas.push(suggestArray[i]);
                		 //console.log(suggestArray[i][0]);
                	 }
                	 drawMap(userArray,suggestArray);
                	 

                	 /* $.ajax({
      				       type: "GET",
      				       url: "http://120.79.42.137:8080/Entity/Ud7adca934ab4e/Card/User",
      				       dataType:"json",
      				     //  data: {name:$("#username").val()},
      				       success: function(data) {
      				         if(data!=null){

      				        	 self.datas=data['User'];
      				         }
      				         else
      				        	 alert("查询失败！");
      				       },
      				       error:function(){
      				    	   alert("ajax失败");
      				       }
      				     });*/
                  } ,
              addRelation: function (index1) {  
              	//***************获取数据的方法，绑定的时候传递vue实例*****************  
              	  //console.log(targetdata);  
                    //alert(targetdata.name);
                    var currenttimestamp= Number(new Date());
                    var adder=getCookie('username');
                    var addee=this.datas[index1][0];
                   // var addee=this.datas[index1]['name'];
                    //alert(addee);
                    var self = this;
                    //var adder = "jinyueyuan";
  					$.ajax({
  					       type: "POST",
  					       url: "http://120.79.42.137:8080/Entity/Ud7adca934ab4e/Card/Userrelation",
  					       dataType:"json",
  					       contentType:"application/json",
  					       data: JSON.stringify({adder:adder,addee:addee,
  					    	   createtime:currenttimestamp,flag:1,relation:"同事关系"}),
  					       success: function(data) {
  					         if(data!=null){
  					        	 alert("添加成功");
  					        	 self.datas.splice(index1,1);
  					         }
  					         else 
  					        	 alert("添加失败！");
  					       },
  					       error:function(){
  					    	   alert("ajax失败");
  					       }
  					     });
  					/*$.ajax({
				       type: "DELETE",
				       url: "http://120.79.42.137:8080/Entity/Ud7adca934ab4e/Card/Userrelation/1514021857359",
				       dataType:"json",
				       success: function(data) {
				         if(data!=null){
				       
				        	 alert("添加成功");
				         }
				         else 
				        	 alert("添加失败！");
				       },
				       error:function(){
				    	   alert("ajax失败");
				       }
				     });*/
              }
              },
              created: function () {  //初始化事件里边去调用查询方法  
                  this.getdata();  
              }  
             
          });  
			
			
			new Vue({
				  el: '#username',
				  data: {
				    username: getCookie('username')
				  }
				})
				 function logout(){
					 delCookie('username');
					 window.location.href="login.html";
				 }
			function computeRelation(adder,maps){
				$.ajax({
				       type: "GET",
				       url: "http://120.79.42.137:8080/Entity/Ud7adca934ab4e/Card/Userrelation?Userrelation.adder="+adder,
				       dataType:"json",
				       async:false,
				     //  data: {name:$("#username").val()},
				       success: function(data) {
				         if(!$.isEmptyObject(data)){ 
				        	 var objects = data['Userrelation'];
				        	 for(var i=0;i<objects.length;i++){
			        			 userArray.push(objects[i]);
					        		if(!userMap.has(objects[i]['addee'])){
					        			if(maps.has(objects[i]['addee'])){
							        		var number = maps.get(objects[i]['addee']);
							        		maps.set(objects[i]['addee'],(number+1));
							        	}
							        	else{
							        		maps.set(objects[i]['addee'],1);
							        	}
					        		}
					        	}   		
				        	 if(count==0){
				        		 //objectnumber=objects.length;
				        		 for(var i=0;i<objects.length;i++){
				        			 count++;
				        			 computeRelation(objects[i]['addee'],suggestMap);
				        		 }
				        	 }
				 
				         }
				         else 
				        	 console.log("查询失败！");
				       },
				       error:function(){
				    	   alert("ajax失败");
				       }
				})
			}
			function wenzhianalyze(){
				//https://wenzhi.api.qcloud.com/v2/index.php?Action=TextKeywords
				/*公共参数Action:TextKeywords,SecretId,Timestamp:当前时间戳，Nonce：随机正整数
				业务参数：title：新闻标题,channel:新闻频道（可选）,content:新闻正文
				返回码：code:0为成功，其他为失败，message:错误信息，keywords：关键词提取的结果，其中Array元素包含以下字段
				score Double 关键词权重；keyword	 String 关键词提取服务对文本标记的标签；type String keyword（文本中出现的关键词） topic（话题）
				*/
				$.ajax({
					type: "GET",
				       url: "https://wenzhi.api.qcloud.com/v2/index.php?"+
				 		   "Action=TextKeywords"+
				 		   "&title=Dior新款，秋冬新款娃娃款甜美圆领配毛领毛呢大衣外套、码数：SM、P330"+
				 		   "&content=Dior新款，秋冬新款娃娃款甜美圆领配毛领毛呢大衣外套、码数：SM、P330"+
				 		   "&Region=sz"+
				 		   "&Timestamp=1514094425"+
				 		   "&Signature=E0CPWHLtQZzeaNspVxBSPszmbTDXOe8hHlcziB8rrag%3D"+
				 		   "&SecretId=AKIDlPtDMKjpJcnpgQwPdgYHpCOVUI1fosDS"+
				 		   "&Nonce=345122",	    	    
				       dataType:"json",
				       success: function(data) {
					        alert(data);
					 
					       },
					       error:function(){
					    	   alert("ajax失败");
					       }
					})
			}
			
		</script>
		<script src="assets/js/bootstrap.min.js"></script>
		<script src="assets/js/typeahead-bs2.min.js"></script>

		<!-- page specific plugin scripts -->

		<!-- ace scripts -->

		<script src="assets/js/ace-elements.min.js"></script>
		<script src="assets/js/ace.min.js"></script>
		
		<!-- inline scripts related to this page -->
	
</body>
</html>
